generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Contractor {
  id           String   @id @default(cuid())
  companyName  String
  slug         String   @unique
  email        String   @unique
  phone        String
  trades       String[]
  leads        Lead[]
  estimates    Estimate[]
  createdAt    DateTime @default(now())
}

model Lead {
  id              String     @id @default(cuid())
  contractorId    String
  contractor      Contractor @relation(fields: [contractorId], references: [id], onDelete: Cascade)
  homeownerName   String
  homeownerEmail  String
  homeownerPhone  String
  address         String
  tradeType       String
  budget          Decimal?   @db.Decimal(12, 2)
  timeline        String?
  status          String     @default("new")
  score           Float?
  notes           String?    @db.Text
  photos          Photo[]
  estimates       Estimate[]
  createdAt       DateTime   @default(now())
}

model Photo {
  id        String   @id @default(cuid())
  leadId    String
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  url       String
  key       String   @unique
  metadata  Json?
  createdAt DateTime @default(now())
}

model Estimate {
  id           String     @id @default(cuid())
  leadId       String
  contractorId String
  lead         Lead       @relation(fields: [leadId], references: [id], onDelete: Cascade)
  contractor   Contractor @relation(fields: [contractorId], references: [id], onDelete: Cascade)
  lineItems    Json
  subtotal     Decimal?   @db.Decimal(12, 2)
  margin       Decimal?   @db.Decimal(5, 2)
  contingency  Decimal?   @db.Decimal(5, 2)
  total        Decimal?   @db.Decimal(12, 2)
  confidence   Int?
  status       String      @default("draft")
  proposalUrl  String?
  createdAt    DateTime    @default(now())
}
